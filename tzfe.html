function move(direction) {
  // direction: 0 = up, 1 = right, 2 = down, 3 = left
  let rotated = [...grid.map(r => [...r])];
  for (let i = 0; i < direction; i++) rotated = rotateClockwise(rotated);

  let moved = false;
  rotated = rotated.map(row => {
    const newRow = slide(row);
    if (JSON.stringify(newRow) !== JSON.stringify(row)) moved = true;
    return newRow;
  });

  for (let i = 0; i < (4 - direction) % 4; i++) rotated = rotateClockwise(rotated);

  if (moved) {
    for (let r = 0; r < 4; r++) {
      for (let c = 0; c < 4; c++) {
        grid[r][c] = rotated[r][c];
      }
    }
    addRandomTile();
    drawGrid();
  }
}

// Updated arrow key mapping
document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp") move(0);
  if (e.key === "ArrowRight") move(1);
  if (e.key === "ArrowDown") move(2);
  if (e.key === "ArrowLeft") move(3);
});

// Updated on-screen button mapping
document.getElementById("up").onclick = () => move(0);
document.getElementById("right").onclick = () => move(1);
document.getElementById("down").onclick = () => move(2);
document.getElementById("left").onclick = () => move(3);
